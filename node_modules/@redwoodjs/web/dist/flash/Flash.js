"use strict";

var _interopRequireWildcard = require("@babel/runtime-corejs3/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js/object/define-property");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.default = void 0;

var _map = _interopRequireDefault(require("@babel/runtime-corejs3/core-js/instance/map"));

var _concat = _interopRequireDefault(require("@babel/runtime-corejs3/core-js/instance/concat"));

var _setTimeout2 = _interopRequireDefault(require("@babel/runtime-corejs3/core-js/set-timeout"));

var _react = _interopRequireWildcard(require("react"));

var _FlashContext = require("./FlashContext");

const FlashMessage = ({
  message,
  timeout
}) => {
  var _context;

  const {
    dismissMessage,
    cycleMessage
  } = (0, _FlashContext.useFlash)();
  const [classes, setClasses] = (0, _react.useState)('');
  (0, _react.useEffect)(() => {
    cycleMessage(message.id); // cycleMessage should not trigger update
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [message.id]);
  (0, _react.useEffect)(() => {
    let fadeOutTimer;

    if (timeout) {
      fadeOutTimer = (0, _setTimeout2.default)(() => {
        setClasses('rw-slide-up');
      }, timeout);
    }

    return () => clearTimeout(fadeOutTimer);
  }, [timeout]);
  return /*#__PURE__*/_react.default.createElement("div", {
    className: (0, _concat.default)(_context = "rw-flash-message ".concat(message.classes, " ")).call(_context, classes),
    style: message.style,
    "data-testid": "message"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "rw-flash-message-text"
  }, message.text), /*#__PURE__*/_react.default.createElement("div", {
    className: "rw-flash-message-dismiss",
    "data-testid": "dismiss",
    onClick: () => dismissMessage(message.id)
  }, "+"));
};

const Flash = ({
  timeout
}) => {
  const {
    messages
  } = (0, _FlashContext.useFlash)();

  if (!messages.length) {
    return null;
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "rw-flash",
    "data-testid": "flash"
  }, (0, _map.default)(messages).call(messages, msg => /*#__PURE__*/_react.default.createElement(FlashMessage, {
    key: msg.id,
    message: msg,
    timeout: timeout
  })));
};

var _default = Flash;
exports.default = _default;